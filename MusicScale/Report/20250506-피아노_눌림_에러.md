
# PianoViewController í‚¤ëˆŒë¦¼ ì—ëŸ¬

## ì¦ìƒ
- í”¼ì•„ë…¸ì—ì„œ ë“œë˜ê·¸ ì œìŠ¤ì²˜ ë“±ì„ í•  ë•Œ ë©ˆì¶”ê³ ì ì˜ë„í•œ í‚¤ì—ì„œ ìŒì´ ë©ˆì¶”ì§€ ì•ŠìŒ
  - ì˜ˆ) 12, 11ë²ˆ ìœ¼ë¡œ ë“œë˜ê·¸í•´ì„œ 11ë²ˆì—ì„œ ë©ˆì¶°ì•¼ í•˜ëŠ”ë° 11ë²ˆì´ ë©ˆì¶”ì§€ ì•Šê³  5ë²ˆ í‚¤ê°€ ì´ë²¤íŠ¸ì— ê¸°ë¡ë¨
  
```plain
ë¡œê·¸ì™€ ì½”ë“œë¥¼ ë³´ê³  ì™œ 8ë²ˆì´ changeKeyPress ì´ë²¤íŠ¸ì— ë“¤ì–´ê°”ëŠ”ì§€, 11ë²ˆ ì¸ë±ìŠ¤ í‚¤ê°€ ì‚­ì œë˜ì§€ ì•Šì•˜ëŠ”ì§€ í™•ì¸
- ë‚´ ì˜ë„ëŠ” 11ë²ˆì—ì„œ ë©ˆì¶”ê³  current touched keysê°€ ì‚­ì œë˜ì—ˆì–´ì•¼í•¨

stopKeyPress(_:) Gesture: isContainKeyInCurrentTouchKeys: true
Gesture: (prevTouchedKey != keyInfo) 12, 11
Gesture: .ended 1
stopKeyPress(_:) Gesture: isContainKeyInCurrentTouchKeys: false
stopKeyPress(_:) Gesture: not in current: 8
Gesture: current touched keys: ["11,"]
```

---

## ChatGPT ë‹µë³€ (í•´ê²°ë¨)

ì œê³µí•˜ì‹  ë¡œê·¸ì™€ ì½”ë“œ íë¦„ì„ ì¢…í•©í•´ ë³´ë©´, `11ë²ˆ í‚¤ì—ì„œ ì†ì„ ë—€ ìƒí™©`ì„ì—ë„ ë¶ˆêµ¬í•˜ê³ , `8ë²ˆ í‚¤ê°€ í„°ì¹˜ë˜ì–´ ìˆëŠ” ê²ƒì²˜ëŸ¼ ì²˜ë¦¬ë˜ì—ˆê³ `, ê·¸ì— ë”°ë¼ **11ë²ˆ í‚¤ê°€ ì •ìƒì ìœ¼ë¡œ `stopKeyPress` ë˜ì§€ ì•Šì€ ë¬¸ì œ**ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì´ í˜„ìƒì˜ ì›ì¸ì€ **`changeKeyPress(_:)`ì—ì„œì˜ ì²˜ë¦¬ ìˆœì„œì™€ ìƒíƒœ ê´€ë¦¬ì˜ ë¶ˆì¼ì¹˜**ì…ë‹ˆë‹¤.

---

## ğŸ” ì¬í˜„ëœ ë¡œê·¸ ë¶„ì„ ìš”ì•½

```
stopKeyPress(_:) Gesture: isContainKeyInCurrentTouchKeys: true
Gesture: (prevTouchedKey != keyInfo) 12, 11
Gesture: .ended 1
stopKeyPress(_:) Gesture: isContainKeyInCurrentTouchKeys: false
stopKeyPress(_:) Gesture: not in current: 8
Gesture: current touched keys: ["11,"]
```

### â›“ï¸ ë¡œê·¸ ìˆœì„œë¡œ ë³¸ ìƒí™© ì •ë¦¬

1. `prevTouchedKey = 12` ìƒíƒœì—ì„œ ì†ê°€ë½ì´ 11ë¡œ ì´ë™ë¨
   â†’ `changeKeyPress(11)` í˜¸ì¶œ

2. ë‚´ë¶€ ì¡°ê±´ì— ë”°ë¼

   * `stopKeyPress(12)` í˜¸ì¶œ â†’ 12ë²ˆ í‚¤ í•´ì œë¨
   * `startKeyPress(11)` í˜¸ì¶œ â†’ 11ë²ˆ í‚¤ ëˆŒë¦¼
   * `prevTouchedKey = nil` ë˜ëŠ” `11`ë¡œ ë³€ê²½ë˜ì—ˆì„ ê²ƒ (ì½”ë“œìƒì€ nilì´ ì•ˆ ë¨)

3. ì†ê°€ë½ì´ í™”ë©´ì—ì„œ ë–¨ì–´ì§
   â†’ `.ended` ì´ë²¤íŠ¸ ë°œìƒ
   â†’ `stopKeyPress(11)` ì‹œë„ë˜ì—ˆì–´ì•¼ í•¨

4. ê·¸ëŸ°ë° ì‹¤ì œë¡œëŠ” `keyInfo = 8`ì´ ê°ì§€ë˜ì–´

   * `stopKeyPress(8)` í˜¸ì¶œë¨
   * 8ë²ˆì€ `currentTouchedKeys`ì— ì—†ìœ¼ë¯€ë¡œ "not in current"ë¡œ ì‹¤íŒ¨
   * **11ë²ˆì€ í•´ì œë˜ì§€ ì•ŠìŒ**

---

## ğŸ§  ì›ì¸ ë¶„ì„

### ë¬¸ì œ â‘ : `.ended`ì—ì„œ ê°ì§€ë˜ëŠ” `keyInfo`ê°€ ì‹¤ì œ í„°ì¹˜ í‚¤ê°€ ì•„ë‹˜

`gesture.location(in: gesture.view)` ìœ„ì¹˜ì—ì„œ `getKeyInfoBy`ê°€ 8ë²ˆ í‚¤ë¡œ ê°ì§€ë˜ì—ˆëŠ”ë°,
**ì‚¬ìš©ìëŠ” 11ë²ˆ í‚¤ì—ì„œ ì†ì„ ë—ë‹¤ê³  ìƒê°í•˜ê³  ìˆìŒ.**

â¡ï¸ ì´ëŠ” **ì†ì„ ë–¼ëŠ” ì‹œì ì— í„°ì¹˜ ì¢Œí‘œê°€ ì•½ê°„ ì´ë™ë˜ì–´ 8ë²ˆ í‚¤ë¡œ íŒë³„ëœ ê²ƒ**ì…ë‹ˆë‹¤.

### ë¬¸ì œ â‘¡: `prevTouchedKey` í™œìš© ë¡œì§ì´ ëˆ„ë½ë˜ì—ˆê±°ë‚˜ ë®ì–´ì”Œì›Œì§

`.ended` ì²˜ë¦¬ë¶€ì— `keyInfo`ê°€ nilì´ ì•„ë‹ ê²½ìš°ì—ë„ `prevTouchedKey`ë¥¼ ìš°ì„ ì ìœ¼ë¡œ í™œìš©í•˜ì§€ ì•ŠìŒ:

```swift
if let keyInfo = viewPiano.viewModel.getKeyInfoBy(touchLocation: location) {
  print("Gesture: .ended 1")
  stopKeyPress(keyInfo)
} else if let prevTouchedKey {
  print("Gesture: .ended 2")
  stopKeyPress(prevTouchedKey)
}
```

ì´ ê²½ìš° `keyInfo = 8`ë¡œ ì˜ëª» íŒë‹¨ë˜ë©´ 11ë²ˆì€ ì œê±°ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

---

## âœ… í•´ê²° ë°©ì•ˆ ì œì•ˆ

### âœ”ï¸ ë°©ë²• 1: `.ended` ì´ë²¤íŠ¸ì—ì„œ `prevTouchedKey`ë¥¼ í•­ìƒ ìš°ì„ ì ìœ¼ë¡œ ì •ë¦¬

```swift
case .ended:
  guard isKeyPressEnabled else { return }
  if let prevTouchedKey {
    print("Gesture: .ended using prevTouchedKey")
    stopKeyPress(prevTouchedKey)
  } else if let keyInfo = viewPiano.viewModel.getKeyInfoBy(touchLocation: location) {
    print("Gesture: .ended fallback keyInfo")
    stopKeyPress(keyInfo)
  }
```

ì´ë ‡ê²Œ í•˜ë©´ **ì†ì„ ë—„ ë•Œ prevTouchedKeyë¥¼ ì •í™•íˆ ì œê±°**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

### âœ”ï¸ ë°©ë²• 2: `changeKeyPress`ì—ì„œ `prevTouchedKey = keyInfo`ë¥¼ ë” ì•ˆì „í•˜ê²Œ ê´€ë¦¬

ê¸°ì¡´:

```swift
guard !viewPiano.viewModel.currentTouchedKeys.contains(keyInfo) else {
  prevTouchedKey = keyInfo
  return
}
```

ë¬¸ì œì : `currentTouchedKeys.contains(keyInfo)` ì¡°ê±´ì´ ë„ˆë¬´ ë¹¨ë¦¬ `prevTouchedKey`ë¥¼ ë®ì–´ì”€.

ê°œì„ :

```swift
guard !viewPiano.viewModel.currentTouchedKeys.contains(keyInfo) else {
  // ì´ì „ prevTouchedKeyëŠ” ìœ ì§€
  return
}
```

ë˜ëŠ” `prevTouchedKey`ë¥¼ `touch began`ì—ì„œë§Œ ì„¤ì •í•˜ê³  `change`ì—ì„œëŠ” ê°±ì‹ í•˜ì§€ ì•Šë„ë¡ í•´ë„ ì¢‹ìŠµë‹ˆë‹¤.

---
